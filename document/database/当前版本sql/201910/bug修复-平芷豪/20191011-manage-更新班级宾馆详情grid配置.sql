-- 更新 班级宾馆详情 grid配置
UPDATE `grid_basic_config`
SET `entity_class` = 'com.whaty.domain.bean.ClassHotelDetail',
 `sqlstr` = 'SELECT\n	r.id AS id,\n	r.unitName AS unitName,\n	r.classCode AS classCode,\n	r.className AS className,\n	r.linkman AS linkman,\n	r.linkPhone AS linkPhone,\n	r.startTime AS startTime,\n	r.endTime AS endTime,\n	r.note AS note,\n	r.totalPrice AS totalPrice,\n	r.applyTime AS applyTime,\n	r.applyUser AS applyUser,\n	r.detailId AS detailId,\n	count(DISTINCT stu.id) AS studentNumber\nFROM\n	(\n		SELECT\n			c.id AS cid,\n			chd.id AS id,\n			un. NAME AS unitName,\n			c. CODE AS classCode,\n			c. NAME AS className,\n			tea.true_name AS linkman,\n			tea.mobile AS linkPhone,\n			chd.start_time AS startTime,\n			chd.end_time AS endTime,\n			chd.note AS note,\n			sum(cha.female_price * cha.female_room_number) + sum(cha.male_price * cha.male_room_number) AS totalPrice,\n			chd.apply_time AS applyTime,\n			au.login_id AS applyUser,\n			chd.id AS detailId\n		FROM\n			pe_class c\n		INNER JOIN class_hotel_detail chd ON chd.id = c.fk_class_hotel_detail_id\n		INNER JOIN pe_unit un ON un.id = c.fk_unit_id\n    AND [peUnit|un.id]\n		LEFT JOIN class_hotel_arrange cha ON cha.fk_class_hotel_detail_id = chd.id\n		INNER JOIN sso_user au ON au.id = chd.apply_user\n		LEFT JOIN pe_teacher tea ON tea.id = c.fk_class_master_id\n		WHERE\n			c.site_code = \'${siteCode}\'\n		GROUP BY\n			c.id\n	) r\nLEFT JOIN pe_student stu ON stu.fk_class_id = r.cid\nGROUP BY\n	r.cid'
WHERE
	(`id` = 'classHotelDetail');